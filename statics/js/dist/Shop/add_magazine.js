$(function(){!function(){$(".diy-actions").find(".j-page-addModule").click(function(){$(".diy-ctrl-item").each(function(){var e=$(this),t=e.data("origin");"pagetitle"==t&&($("html,body").animate({scrollTop:"85px"},300),e.show().siblings().remove())})});var e=$(".j-page-hasMargin"),t=$("#diy-phone");e.length&&(e.filter("[value=1]").attr("checked",!0),t.removeClass("noMargin"),e.change(function(){var e=$(this).val();1==e?t.removeClass("noMargin"):t.addClass("noMargin")}));var a=$("#j-page-backgroundColor");if(a.length){var i="#f8f8f8",n=$("#diy-contain");a.css("backgroundColor",i).data("color",i),n.css("backgroundColor",i),a.ColorPicker({color:i,onShow:function(e){return $(e).fadeIn(500),!1},onHide:function(e){return $(e).fadeOut(500),!1},onChange:function(e,t,i){var t="#"+t;a.css("backgroundColor",t).data("color",t),n.css("backgroundColor",t)}})}}(),function(){$(".j-show-spread").hide(),$(".j-isOpenSpread").change(function(){1==$(this).val()?$(".j-show-spread").show():$(".j-show-spread").hide()})}();var e=[],t=function(){var t=_.template($("#tpl_add_edit_mgzCat_item").html(),{dataset:e});$(".j-mgzCateList").remove(),$(t).insertBefore(".j-addMgzCate")};$(".j-addMgzCate").click(function(){$(this);HYD.popbox.MgzAndMgzCate("mgzCateMulti",function(a,i){e=e.concat(a),t()})}),$(".j-title-selectimg").click(function(){HYD.popbox.ImgPicker(function(e){$(".j-view_pic-ipt").attr("src",e[0]),t()})}),$(document).on("click",".j-delMgzCate",function(){var a=$(this).parent("li").index();e.splice(a,1),t()});var a=function(){var t=HYD.DIY.Unit.getData(),a=$("#j-excerpt").val(),i=$(".j-isOpenSpread:checked").val(),n=null;if(t.page.category=e,t.page.excerpt=a,t.page.isOpenSpread=i,n={title:t.page.title,subtitle:t.page.subtitle,view_pic:t.page.view_pic,praise_num:t.page.praise_num,is_preview:0,category:e,excerpt:a,isOpenSpread:i},1==i){var o=$(".j-spreadTotalPoint").val(),s=$(".j-spreadLimitPoint").val(),r=$(".j-spreadVisitCount").val(),c=$(".j-spreadVisitCountPoint").val();t.page.spreadTotalPoint=n.spreadTotalPoint=o,t.page.spreadLimitPoint=n.spreadLimitPoint=s,t.page.spreadVisitCount=n.spreadVisitCount=r,t.page.spreadVisitCountPoint=n.spreadVisitCountPoint=c}return n.content=JSON.stringify(t),n};$("#j-savePage").click(function(){var e=a();return $.ajax({url:window.location.href,type:"post",dataType:"json",data:e,beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，保存成功！"),setTimeout(function(){window.location.href="/Shop/list_magazine/status/0"},1e3)):HYD.hint("danger","对不起，保存失败："+e.msg),$.jBox.hideloading()}}),!1}),$("#j-saveAndPrvPage").click(function(){var e=a();return $.ajax({url:window.location.href,type:"post",dataType:"json",data:e,beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，保存成功！"),setTimeout(function(){window.open(e.link)},1e3)):HYD.hint("danger","对不起，保存失败："+e.msg),$.jBox.hideloading()}}),!1})});