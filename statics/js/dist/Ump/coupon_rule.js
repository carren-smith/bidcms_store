$(function(){var o=$('input[name="type"]').val();$(".j-btn-AddEdit").click(function(){var n=$(this),t=n.data("action"),e=null;switch(t){case"add":e={coupon_money:0,coupon_id:0};break;case"edit":e={id:n.data("id"),coupon_money:n.data("coupon_money"),coupon_id:n.data("coupon_id")}}if(1==o)var a=$("#tpl_ump_coupon_rule");else var a=$("#tpl_ump_buy_coupon");var i=a.html(),d=_.template(i,e);$.jBox.show({title:"提示",content:d,onOpen:function(o){o.find("select[name=coupon_id]").val(e.coupon_id)},btnOK:{onBtnClick:function(n){var a=n.find("input[name=coupon_money]"),i=n.find("select[name=coupon_id]"),d=a.val(),c=i.val();return d.length?0==c?void HYD.FormShowError(i,"请选择优惠券"):(e.coupon_money=d,e.coupon_id=c,e.type=o,e.handle=t,$.ajax({url:"/Ump/handle_coupon_rule?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:e,beforeSend:function(){$.jBox.showloading()},success:function(o){1==o.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+o.msg),$.jBox.hideloading()}}),void $.jBox.close(n)):void HYD.FormShowError(a,"请输入所需金额")}}})}),$(".j-btn-del").click(function(){var n=$(this).data("id");$.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(t){$.jBox.close(t),$.ajax({url:"/Ump/handle_coupon_rule?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:n,type:o,handle:"delete"},beforeSend:function(){$.jBox.showloading()},success:function(o){1==o.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+o.msg),$.jBox.hideloading()}})}}})})});